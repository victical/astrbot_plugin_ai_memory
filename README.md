# AstrBot 记忆插件

一个为 AstrBot 提供记忆功能的插件，让 AI 能够记住对话中的重要信息。

## 功能特性

- **多场景适配**：私聊记忆与群聊记忆独立管理，支持全局群聊记忆模式。
- **语义级检索**：结合 Bigram 关键词评分与 LLM 语义精选（Rerank），确保记忆提取极致精准。
- **时空感知**：自动注入当前时间与记录时间戳，AI 能够分辨“陈年旧事”与“新鲜资讯”。
- **身份自动标签**：所有记忆自动关联发送者昵称与 ID，彻底解决多用户身份混淆。
- **工业级稳健**：采用原子化写入机制防止数据损坏，支持智能去重。

## 安装方法

1. 将 `ai_memory` 文件夹放入 AstrBot 的 `data/plugins/` 目录。
2. 重启 AstrBot 即可自动加载。

## 配置项说明

在 AstrBot 管理面板中可进行以下配置：

| 配置项 | 说明 | 默认值 |
| :--- | :--- | :--- |
| `max_memories` | 每个会话最大记忆数量 (上限提升至 300) | 10 |
| `auto_save_enabled` | 是否允许 AI 自动保存发现的重要信息 | true |
| `importance_threshold` | AI 自动保存的最低重要性阈值 (1-5) | 3 |
| `enable_auto_injection` | 是否启用记忆自动注入（回复前自动参考背景） | true |
| `rerank_provider_id` | **【高级】**选择用于精选记忆的大模型 | "" |
| `recall_top_k` | 算法初筛候选记忆的数量 | 10 |
| `inject_top_k` | 最终注入到对话中的记忆上限 | 3 |
| `enable_global_memory` | 是否启用全局群聊记忆（所有群聊共享） | false |

## 指令列表

### 🔍 查看与搜索
- `/memory list` - 列出当前会话的记忆（包含身份标签与时间）。
- `/memory list_group [群号]` - 查询指定或当前群聊的记忆。
- `/memory search <关键词>` - 搜索相关记忆。
- `/memory stats` - 查看当前会话的记忆统计。

### ✏️ 手动维护
- `/memory add <内容>` - 手动记录信息（自动打上你的身份标签）。
- `/memory edit <序号> <新内容>` - 修改已存在的记忆。
- `/memory update <序号> <重要性>` - 调整重要性等级 (1-5)。

### 🗑️ 清理操作
- `/memory remove <序号>` - 删除指定的单条记忆。
- `/memory clear` - 清空当前会话的所有记忆。

## 更新日志

### v1.2.6
- **【反诈增强】上线冒充检测系统**：系统会自动对比机器人真实 QQ 与记忆记录中的 QQ。若发现非机器人本人却使用了包含机器人名字（小糯）的昵称，将自动标记并触发【警报】，防止 AI 被群友“钓鱼”或误导。
- 增强了 Prompt 的安全等级，指挥 AI 识破身份伪装。

### v1.2.5

### v1.1.7
- **【身份感知】**：所有记忆自动打上 `[昵称(QQ) 提到]` 标签，解决多用户身份混淆。
- **【算法进化】**：引入 Bigram 滑动窗口匹配，大幅提升中文检索精度。

### v1.1.2
- **【安全加固】**：实现原子化写入（.tmp 机制），防止 JSON 文件损坏。
- **【智能去重】**：自动合并相似记忆，节省空间。

## 作者

- 作者：kjqwdw、victical
- 版本：v1.2.5

## 支持

如需帮助，请参考 [AstrBot 插件开发文档](https://astrbot.soulter.top/center/docs/%E5%BC%80%E5%8F%91/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/)
